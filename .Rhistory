.by = period
) |>
round(digits=3) |>
gt(caption = "Ratio commitments\nperiod t / period t-1")
summarize(data,
min=min(ratio, na.rm = T),
median=median(ratio, na.rm = T),
mean=mean(ratio, na.rm = T),
max=max(ratio, na.rm = T),
.by = period
) |>
round(digits=3) |>
gt(caption = "Ratio commitments\nperiod t / period t-1")
data
summarize(data,
min=min(ratio, na.rm = T),
median=median(ratio, na.rm = T),
mean=mean(ratio, na.rm = T),
max=max(ratio, na.rm = T),
.by = period
)
?round
summarize(data,
min=min(ratio, na.rm = T),
median=median(ratio, na.rm = T),
mean=mean(ratio, na.rm = T),
max=max(ratio, na.rm = T),
.by = period
) |>
round(-period, digits=3)
summarize(data,
min=min(ratio, na.rm = T),
median=median(ratio, na.rm = T),
mean=mean(ratio, na.rm = T),
max=max(ratio, na.rm = T),
.by = period
) |>
gt(caption = "Ratio commitments\nperiod t / period t-1")
summarize(data,
min=round(min(ratio, na.rm = T), 3),
median=median(ratio, na.rm = T),
mean=mean(ratio, na.rm = T),
max=max(ratio, na.rm = T),
.by = period
) |>
gt(caption = "Ratio commitments\nperiod t / period t-1")
?gt
summarize(data,
min=round(min(ratio, na.rm = T), 3),
median=round(median(ratio, na.rm = T), 3),
mean=round(mean(ratio, na.rm = T), 3),
max=round(max(ratio, na.rm = T), 3),
.by = period
) |>
gt(caption = "Ratio commitments\nperiod t / period t-1")
# boxplot: median
ggbetweenstats(
data = data,
x = period,
y = ratio,
centrality.plotting = TRUE,
type = "np",
bf.message = F,
results.subtitle = F,
violin.args = list(width = 0, linewidth = 0),
xlab = "Period (treatment = 0)",
ylab = "Ratio current/lag commitments",
title = "Ratio between current and lag commitments to affected countries",
caption = "Removed outlier: Ukraine"
)
data |>
filter(ratio < 10) |>
mutate(period = factor(period, levels=c("5", "4", "3", "2", "1", "0", "-1", "-2", "-3", "-4", "-5"))) |>
ggplot(aes(x = ratio, y = period, fill=period)) +
geom_density_ridges(alpha=0.3, bins=100) +
scale_fill_viridis_d() +
theme_minimal() +
labs(title="Distribution of ratio between current and lag commitments to affected countries",
subtitle="Outlier = Ukraine",
x="Commitments in period t / Commitments in period t-1",
y="Period (treatment = 0)",
caption="Remove outliers: ratio > 10")
# histogram
data |>
filter(ratio < 10) |>
mutate(period = factor(period, levels=c("5", "4", "3", "2", "1", "0", "-1", "-2", "-3", "-4", "-5")),
treatment=ifelse(period==0,1,0)) |>
ggplot(aes(x = ratio, y = period, fill=treatment)) +
scale_fill_manual(values=c("grey", "coral")) +
theme_minimal() +
labs(title="Distribution of ratio between current and lag commitments to affected countries",
x="Commitments in period t / Commitments in period t-1",
y="Period (treatment = 0)",
caption="Remove outliers: ratio > 10")
data |>
filter(ratio < 10) |>
mutate(period = factor(period, levels=c("5", "4", "3", "2", "1", "0", "-1", "-2", "-3", "-4", "-5")),
treatment=ifelse(period==0,"Treatment","Control")) |>
ggplot(aes(x = ratio, y = period, fill=treatment)) +
scale_fill_manual(values=c("grey", "coral")) +
theme_minimal() +
labs(title="Distribution of ratio between current and lag commitments to affected countries",
x="Commitments in period t / Commitments in period t-1",
y="Period (treatment = 0)",
caption="Remove outliers: ratio > 10")
data |>
filter(ratio < 10) |>
mutate(period = factor(period, levels=c("5", "4", "3", "2", "1", "0", "-1", "-2", "-3", "-4", "-5")),
treatment=ifelse(period==0,"Treatment","Control")) |>
ggplot(aes(x = ratio, y = period, fill=treatment)) +
geom_density_ridges(alpha=0.3) +
scale_fill_manual(values=c("grey", "coral")) +
theme_minimal() +
labs(title="Distribution of ratio between current and lag commitments to affected countries",
x="Commitments in period t / Commitments in period t-1",
y="Period (treatment = 0)",
caption="Remove outliers: ratio > 10")
data |>
filter(ratio < 10) |>
mutate(period = factor(period, levels=c("5", "4", "3", "2", "1", "0", "-1", "-2", "-3", "-4", "-5")),
treatment=ifelse(period==0,"Treatment","Control")) |>
ggplot(aes(x = ratio, y = period, fill=treatment)) +
geom_density_ridges(alpha=0.3) +
scale_fill_manual(values=c("grey", "coral")) +
theme_minimal() +
labs(title="Distribution of current/lag commitments ratio",
x="Commitments in period t / Commitments in period t-1",
y="Period (treatment = 0)",
caption="Remove outliers: ratio > 10")
data |>
filter(ratio < 10) |>
mutate(period = factor(period, levels=c("5", "4", "3", "2", "1", "0", "-1", "-2", "-3", "-4", "-5")),
treatment=ifelse(period==0,"Treatment","Control")) |>
ggplot(aes(x = ratio, y = period, fill=treatment)) +
geom_density_ridges(alpha=0.3) +
scale_fill_manual(values=c("grey", "coral")) +
geom_vline(xintercept = 1, linetype="dashed", linewidth=1) +
theme_minimal() +
labs(title="Distribution of current/lag commitments ratio",
subtitle = "Ratio < 1 = decrease in annual aid commitments",
x="Commitments in period t / Commitments in period t-1",
y="Period (treatment = 0)",
caption="Remove outliers: ratio > 10")
?scale_y_continuous
data |>
filter(ratio < 10) |>
mutate(period = factor(period, levels=c("5", "4", "3", "2", "1", "0", "-1", "-2", "-3", "-4", "-5")),
treatment=ifelse(period==0,"Treatment","Control")) |>
ggplot(aes(x = ratio, y = period, fill=treatment)) +
geom_density_ridges(alpha=0.3) +
scale_fill_manual(values=c("grey", "coral")) +
geom_vline(xintercept = 1, linetype="dashed", linewidth=1) +
scale_y_continuous(breaks = c(0, 1, 5, 10)) +
theme_minimal() +
labs(title="Distribution of current/lag commitments ratio",
subtitle = "Ratio < 1 = decrease in annual aid commitments",
x="Commitments in period t / Commitments in period t-1",
y="Period (treatment = 0)",
caption="Remove outliers: ratio > 10")
data |>
filter(ratio < 10) |>
mutate(period = factor(period, levels=c("5", "4", "3", "2", "1", "0", "-1", "-2", "-3", "-4", "-5")),
treatment=ifelse(period==0,"Treatment","Control")) |>
ggplot(aes(x = ratio, y = period, fill=treatment)) +
geom_density_ridges(alpha=0.3) +
scale_fill_manual(values=c("grey", "coral")) +
geom_vline(xintercept = 1, linetype="dashed", linewidth=1) +
scale_x_continuous(breaks = c(0, 1, 5, 10)) +
theme_minimal() +
labs(title="Distribution of current/lag commitments ratio",
subtitle = "Ratio < 1 = decrease in annual aid commitments",
x="Commitments in period t / Commitments in period t-1",
y="Period (treatment = 0)",
caption="Remove outliers: ratio > 10")
# histogram
data |>
filter(ratio < 10) |>
mutate(period = factor(period, levels=c("5", "4", "3", "2", "1", "0", "-1", "-2", "-3", "-4", "-5")),
treatment=ifelse(period==0,"Treatment","Control")) |>
ggplot(aes(x = ratio, y = period, fill=treatment)) +
geom_density_ridges(alpha=0.3, stat = "binline") +
scale_fill_manual(values=c("grey", "coral")) +
geom_vline(xintercept = 1, linetype="dashed", linewidth=1) +
scale_x_continuous(breaks = c(0, 1, 5, 10)) +
theme_minimal() +
labs(title="Distribution of current/lag commitments ratio",
subtitle = "Ratio < 1 = decrease in annual aid commitments",
x="Commitments in period t / Commitments in period t-1",
y="Period (treatment = 0)",
caption="Remove outliers: ratio > 10")
data <- between_periods_comparison[period %in% c(-5:5)]
# histogram
data |>
filter(ratio < 10) |>
mutate(period = factor(period, levels=c("5", "4", "3", "2", "1", "0", "-1", "-2", "-3", "-4", "-5")),
treatment=ifelse(period==0,"Treatment","Control")) |>
ggplot(aes(x = ratio, y = period, fill=treatment)) +
geom_density_ridges(alpha=0.3, stat = "binline") +
scale_fill_manual(values=c("grey", "coral")) +
geom_vline(xintercept = 1, linetype="dashed", linewidth=1) +
scale_x_continuous(breaks = c(0, 1, 5, 10)) +
theme_minimal() +
labs(title="Distribution of current/lag commitments ratio",
subtitle = "Ratio < 1 = decrease in annual aid commitments",
x="Commitments in period t / Commitments in period t-1",
y="Period (treatment = 0)",
caption="Remove outliers: ratio > 10")
ggbetweenstats(
data = data,
x = period,
y = ratio,
centrality.plotting = TRUE,
type = "np",
bf.message = F,
results.subtitle = F,
violin.args = list(width = 0, linewidth = 0),
xlab = "Period (treatment = 0)",
ylab = "Ratio current/lag commitments",
title = "Ratio between current and lag commitments to affected countries",
caption = "Removed outlier: Ukraine"
)
summarize(data,
min=min(commit, na.rm = T),
median=median(commit, na.rm = T),
mean=mean(commit, na.rm = T),
max=max(commit, na.rm = T),
IQR=IQR(commit, na.rm = T),
sd=sd(commit, na.rm = T),
.by = period
)
summarize(data,
min=round(min(ratio, na.rm = T), 3),
median=round(median(ratio, na.rm = T), 3),
mean=round(mean(ratio, na.rm = T), 3),
max=round(max(ratio, na.rm = T), 3),
.by = period
) |>
gt(caption = "Ratio commitments\nperiod t / period t-1")
summarize(data,
n=length(),
min=round(min(ratio, na.rm = T), 3),
median=round(median(ratio, na.rm = T), 3),
mean=round(mean(ratio, na.rm = T), 3),
max=round(max(ratio, na.rm = T), 3),
.by = period
) |>
gt(caption = "Ratio commitments\nperiod t / period t-1")
summarize(data,
n=count(recipient_id),
min=round(min(ratio, na.rm = T), 3),
median=round(median(ratio, na.rm = T), 3),
mean=round(mean(ratio, na.rm = T), 3),
max=round(max(ratio, na.rm = T), 3),
.by = period
) |>
gt(caption = "Ratio commitments\nperiod t / period t-1")
summarize(data,
n=length(recipient_id),
min=round(min(ratio, na.rm = T), 3),
median=round(median(ratio, na.rm = T), 3),
mean=round(mean(ratio, na.rm = T), 3),
max=round(max(ratio, na.rm = T), 3),
.by = period
) |>
gt(caption = "Ratio commitments\nperiod t / period t-1")
?pivot_wider
summarize(data,
n=length(recipient_id),
min=round(min(ratio, na.rm = T), 3),
median=round(median(ratio, na.rm = T), 3),
mean=round(mean(ratio, na.rm = T), 3),
max=round(max(ratio, na.rm = T), 3),
.by = period
)
summarize(data,
n=length(recipient_id),
min=round(min(ratio, na.rm = T), 3),
median=round(median(ratio, na.rm = T), 3),
mean=round(mean(ratio, na.rm = T), 3),
max=round(max(ratio, na.rm = T), 3),
.by = period
) |>
pivot_wider(names_from = period,
values_from = c(n:max)) |>
gt(caption = "Ratio commitments\nperiod t / period t-1")
summarize(data,
n=length(recipient_id),
min=round(min(ratio, na.rm = T), 3),
median=round(median(ratio, na.rm = T), 3),
mean=round(mean(ratio, na.rm = T), 3),
max=round(max(ratio, na.rm = T), 3),
.by = period
)
?pivot_longer
summarize(data,
n=length(recipient_id),
min=round(min(ratio, na.rm = T), 3),
median=round(median(ratio, na.rm = T), 3),
mean=round(mean(ratio, na.rm = T), 3),
max=round(max(ratio, na.rm = T), 3),
.by = period
) |>
pivot_longer(-period,
names_to = "stat",
values_to = "value") |>
gt(caption = "Ratio commitments\nperiod t / period t-1")
summarize(data,
n=length(recipient_id),
min=round(min(ratio, na.rm = T), 3),
median=round(median(ratio, na.rm = T), 3),
mean=round(mean(ratio, na.rm = T), 3),
max=round(max(ratio, na.rm = T), 3),
.by = period
) |>
pivot_longer(-period,
names_to = "stat",
values_to = "value") |>
pivot_wider(-stat,
names_from = "period",
values_from = "value") |>
gt(caption = "Ratio commitments\nperiod t / period t-1")
pivot_wider
?pivot_wider
summarize(data,
n=length(recipient_id),
min=round(min(ratio, na.rm = T), 3),
median=round(median(ratio, na.rm = T), 3),
mean=round(mean(ratio, na.rm = T), 3),
max=round(max(ratio, na.rm = T), 3),
.by = period
)
summarize(data,
n=length(recipient_id),
min=round(min(ratio, na.rm = T), 3),
median=round(median(ratio, na.rm = T), 3),
mean=round(mean(ratio, na.rm = T), 3),
max=round(max(ratio, na.rm = T), 3),
.by = period
) |>
gt(caption = "Ratio commitments\nperiod t/period t-1")
summarize(data,
n=length(recipient_id),
min=round(min(ratio, na.rm = T), 3),
median=round(median(ratio, na.rm = T), 3),
mean=round(mean(ratio, na.rm = T), 3),
max=round(max(ratio, na.rm = T), 3),
.by = period
) |>
gt(caption = "Ratio commitments period t/t-1")
summarize(data,
n=length(recipient_id),
min=round(min(ratio, na.rm = T), 3),
median=round(median(ratio, na.rm = T), 3),
mean=round(mean(ratio, na.rm = T), 3),
max=round(max(ratio, na.rm = T), 3),
.by = period
) |>
gt(caption = "Ratio Current/Lag commitments")
summarize(data,
n=length(recipient_id),
min=round(min(ratio, na.rm = T), 3),
median=round(median(ratio, na.rm = T), 3),
mean=round(mean(ratio, na.rm = T), 3),
max=round(max(ratio, na.rm = T), 3),
.by = period
) |>
gt(caption = "Ratio commitments period t/t-1")
summarize(data,
min=min(commit, na.rm = T),
median=median(commit, na.rm = T),
mean=mean(commit, na.rm = T),
max=max(commit, na.rm = T),
IQR=IQR(commit, na.rm = T),
sd=sd(commit, na.rm = T),
.by = period
)
data |>
select(recipient_id, commit, diff, period) |>
fmutate(commit = log10(commit),
highlight = ifelse(period %in% c(-1:0), "Treatment", "Control")
) |>
ggplot(aes(x=period, y=commit, group=recipient_id)) +
geom_vline(xintercept = 0, linetype="dashed", color="slategray4", linewidth=1) +
geom_point(color="grey80") +
geom_line(aes(color=highlight)) +
scale_color_manual(values = c("gray70", "coral")) +
theme_minimal() +
labs(x="Period (treatment = 0)",
y="Commitments (USD, Millions, log10)",
color="Treatment status"
)
data |>
select(recipient_id, commit, diff, period) |>
fmutate(commit = log10(commit),
period = factor(period, levels=c("5", "4", "3", "2", "1", "0", "-1", "-2", "-3", "-4", "-5")),
treatment = ifelse(period %in% c(-1:0), "Treatment", "Control")
) |>
ggplot(aes(x=period, y=commit, group=recipient_id)) +
geom_vline(xintercept = 0, linetype="dashed", color="slategray4", linewidth=1) +
geom_point(color="grey80") +
geom_line(aes(color=treatment)) +
scale_color_manual(values = c("gray70", "coral")) +
theme_minimal() +
labs(x="Period (treatment = 0)",
y="Commitments (USD, Millions, log10)",
color="Treatment status"
)
data |>
select(recipient_id, commit, ratio, period) |>
filter()
mutate(highlight = ifelse(period %in% c(-1:0), "Treatment", "Control")) |>
ggplot(aes(x=period, y=ratio, group=recipient_id)) +
geom_vline(xintercept = 0, linetype="dashed", color="slategray4", linewidth=1) +
geom_point(color="grey80") +
geom_line(aes(color=highlight)) +
scale_color_manual(values = c("gray70", "coral")) +
scale_y_continuous(breaks=c(0, 1, 10, 40)) +
theme_minimal() +
labs(x="Period (treatment = 0)",
y="Ratio",
color="Treatment status"
)
data |>
ggplot(aes(x=period, y=commit, group=recipient_id)) +
geom_vline(xintercept = 0, linetype="dashed", color="coral", linewidth=1) +
geom_line() +
facet_wrap(~ recipient_name, scales = "free_y") +
theme_minimal() +
labs(x="Period (treatment = 0)",
y="Commitments (USD, Millions, log10)",
color="Treatment status"
)
data |>
ggplot(aes(x=period, y=ratio, group=recipient_id)) +
geom_vline(xintercept = 0, linetype="dashed", color="coral", linewidth=1) +
geom_line() +
facet_wrap(~ recipient_name, scales = "free_y") +
theme_minimal() +
labs(x="Period (treatment = 0)",
y="Ratio",
color="Treatment status"
)
# select relevant vars
between_periods_comparison <- data_recip.appeal.binary_single_treatment[, .(
recipient_id, recipient_name,
year,
outcome = n_donors,
treatment = treat_appeal
)
# remove "false" zeroes, i.e., missing obs. due to recipient not registered in crs a period t
][!is.na(treatment),
# order observations
][order(recipient_id, year),
# create new variable `period` where treatment year = 0
][, period := year - year[treatment==1], by = recipient_id
# create new var `lag1`
][, lag1 := shift(outcome, type = "lag"), by = recipient_id
# create new var `diff`
][, diff := outcome - lag1]
# head(between_periods_comparison)
data <- between_periods_comparison[period %in% c(-5:5)]
between_periods_comparison
# histogram
data |>
filter(ratio < 10) |>
mutate(period = factor(period, levels=c("5", "4", "3", "2", "1", "0", "-1", "-2", "-3", "-4", "-5")),
treatment=ifelse(period==0,"Treatment","Control")) |>
ggplot(aes(x = outcome, y = period, fill=treatment)) +
geom_density_ridges(alpha=0.3, stat = "binline") +
scale_fill_manual(values=c("grey", "coral")) +
geom_vline(xintercept = 1, linetype="dashed", linewidth=1) +
scale_x_continuous(breaks = c(0, 1, 5, 10)) +
theme_minimal() +
labs(title="Distribution of the number of donors per country",
x="Number of donors",
y="Period (treatment = 0)")
# histogram
data |>
mutate(period = factor(period, levels=c("5", "4", "3", "2", "1", "0", "-1", "-2", "-3", "-4", "-5")),
treatment=ifelse(period==0,"Treatment","Control")) |>
ggplot(aes(x = outcome, y = period, fill=treatment)) +
geom_density_ridges(alpha=0.3, stat = "binline") +
scale_fill_manual(values=c("grey", "coral")) +
geom_vline(xintercept = 1, linetype="dashed", linewidth=1) +
scale_x_continuous(breaks = c(0, 1, 5, 10)) +
theme_minimal() +
labs(title="Distribution of the number of donors per country",
x="Number of donors",
y="Period (treatment = 0)")
# histogram
data |>
mutate(period = factor(period, levels=c("5", "4", "3", "2", "1", "0", "-1", "-2", "-3", "-4", "-5")),
treatment=ifelse(period==0,"Treatment","Control")) |>
ggplot(aes(x = outcome, y = period, fill=treatment)) +
geom_density_ridges(alpha=0.3, stat = "binline") +
scale_fill_manual(values=c("grey", "coral")) +
geom_vline(xintercept = 1, linetype="dashed", linewidth=1) +
theme_minimal() +
labs(title="Distribution of the number of donors per country",
x="Number of donors",
y="Period (treatment = 0)")
# histogram
data |>
mutate(period = factor(period, levels=c("5", "4", "3", "2", "1", "0", "-1", "-2", "-3", "-4", "-5")),
treatment=ifelse(period==0,"Treatment","Control")) |>
ggplot(aes(x = outcome, y = period, fill=treatment)) +
geom_density_ridges(alpha=0.3, stat = "binline") +
scale_fill_manual(values=c("grey", "coral")) +
theme_minimal() +
labs(title="Distribution of the number of donors per country",
x="Number of donors",
y="Period (treatment = 0)")
