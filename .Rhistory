dat_sample <- data |>
select(donor_id, recipient_id, commitment, period) |>
fmutate(
period = factor(period),
treatment = ifelse(period %in% c(-1:0), "Treatment", "Control"),
group = paste(donor_id, recipient_id, sep = "_")
) |>
filter(uniqueN(period) == 5, .by = group)
dat_sum <- Rmisc::summarySEwithin(dat_sample,
measurevar = "commitment",
withinvars = "period",
idvar = "group",
na.rm = T)
dat_sum
dat_sum
summarize(dat_sample,
median = median(commitment, na.rm = T),
.by = period
)
dat_sample
data
data |>
select(donor_id, recipient_id, commitment, period, ratio)
data |>
select(donor_id, recipient_id, commitment, period, ratio)
data |>
select(donor_id, recipient_id, commitment, period, ratio) |>
fmutate(period = factor(period),
group = paste(donor_id, recipient_id, sep = "_"))
data |>
select(donor_id, recipient_id, commitment, period, ratio) |>
fmutate(period = factor(period),
group = paste(donor_id, recipient_id, sep = "_")) |>
filter(uniqueN(period) == 5, .by = group) |>
summarize(median = median(commitment, na.rm = T), .by = period)
data |>
select(donor_id, recipient_id, period, ratio) |>
fmutate(period = factor(period),
group = paste(donor_id, recipient_id, sep = "_")) |>
filter(uniqueN(period) == 5, .by = group) |>
summarize(median = median(ratio, na.rm = T), .by = period)
data |>
select(donor_id, recipient_id, period, ratio) |>
fmutate(period = factor(period),
group = paste(donor_id, recipient_id, sep = "_")) |>
filter(uniqueN(period) == 5, .by = group) |>
summarize(
median = median(ratio, na.rm = T),
mean = mean(ratio, na.rm = T),
.by = period)
data |>
select(donor_id, recipient_id, period, ratio) |>
fmutate(period = factor(period),
group = paste(donor_id, recipient_id, sep = "_")) |>
filter(uniqueN(period) == 5, .by = group)
data |>
select(donor_id, recipient_id, period, ratio, commitment, lag1) |>
fmutate(period = factor(period),
group = paste(donor_id, recipient_id, sep = "_")) |>
filter(uniqueN(period) == 5, .by = group)
between_periods_comparison <- between_periods_comparison[, .(donor_id, donor_name, recipient_id, recipient_name, year, commitment, treatment)
# create new variable `period` where treatment year = 0
][, period := year - year[treatment==1], by = .(donor_id, recipient_id)
# create new var `lag1`
][order(recipient_id, donor_id, year),
][, lag1 := shift(commitment, type = "lag"), by = .(donor_id, recipient_id)
# create new var `diff`
][, `:=` (
diff = commitment - lag1,
ratio = ifelse(commitment > 0 | lag1 > 0, commitment / lag1, NA)
)]
# create new vars for relative perioding (period) and lags (lag1)
between_periods_comparison <- copy(data_dyad)
between_periods_comparison <- between_periods_comparison[, .(donor_id, donor_name, recipient_id, recipient_name, year, commitment, treatment)
# create new variable `period` where treatment year = 0
][, period := year - year[treatment==1], by = .(donor_id, recipient_id)
# create new var `lag1`
][order(recipient_id, donor_id, year),
][, lag1 := shift(commitment, type = "lag"), by = .(donor_id, recipient_id)
# create new var `diff`
][, `:=` (
diff = commitment - lag1,
ratio = ifelse(commitment > 0 | lag1 > 0, commitment / lag1, NA)
)]
data <- between_periods_comparison[period %in% c(-2:2)]
data |>
select(donor_id, recipient_id, period, ratio, commitment, lag1) |>
fmutate(period = factor(period),
group = paste(donor_id, recipient_id, sep = "_")) |>
filter(uniqueN(period) == 5, .by = group)
# create new vars for relative perioding (period) and lags (lag1)
between_periods_comparison <- copy(data_dyad)
between_periods_comparison <- between_periods_comparison[, .(donor_id, donor_name, recipient_id, recipient_name, year, commitment, treatment)
# create new variable `period` where treatment year = 0
][, period := year - year[treatment==1], by = .(donor_id, recipient_id)
# create new var `lag1`
][order(recipient_id, donor_id, year),
][, lag1 := shift(commitment, type = "lag"), by = .(donor_id, recipient_id)
# create new var `diff`
][, `:=` (
diff = commitment - lag1,
ratio = ifelse(commitment > 0 & lag1 > 0, commitment / lag1, NA)
)]
data <- between_periods_comparison[period %in% c(-2:2)]
data |>
select(donor_id, recipient_id, period, ratio, commitment, lag1) |>
fmutate(period = factor(period),
group = paste(donor_id, recipient_id, sep = "_")) |>
filter(uniqueN(period) == 5, .by = group)
data |>
select(donor_id, recipient_id, period, ratio, commitment, lag1) |>
fmutate(period = factor(period),
group = paste(donor_id, recipient_id, sep = "_")) |>
filter(uniqueN(period) == 5, .by = group) |>
summarize(
median = median(ratio, na.rm = T),
mean = mean(ratio, na.rm = T),
.by = period)
data |>
select(donor_id, recipient_id, period, ratio, commitment, lag1) |>
fmutate(period = factor(period),
group = paste(donor_id, recipient_id, sep = "_")) |>
filter(uniqueN(period) == 5, .by = group) |>
summarize(
N = uniqueN(group),
median = median(ratio, na.rm = T),
mean = mean(ratio, na.rm = T),
.by = period)
data |>
select(donor_id, recipient_id, period, ratio, commitment, lag1) |>
fmutate(period = factor(period),
group = paste(donor_id, recipient_id, sep = "_")) |>
filter(uniqueN(period) == 5, .by = group)
data_sample <- data |>
select(donor_id, recipient_id, period, ratio, commitment, lag1) |>
fmutate(period = factor(period),
group = paste(donor_id, recipient_id, sep = "_")) |>
filter(uniqueN(period) == 5, .by = group)
ggplot(data_sample, aes(x = period, y = ratio)) +
geom_boxplot()
data |>
select(donor_id, recipient_id, period, ratio, commitment, lag1) |>
fmutate(period = factor(period),
group = paste(donor_id, recipient_id, sep = "_")) |>
filter(uniqueN(period) == 5, .by = group) |>
arrange(desc(ratio))
14.287737 / 0.000091
(14.287737 - 0.000091)/0.000091
ggplot(data_sample, aes(x = period, y = commitment)) +
geom_boxplot()
ggplot(data_sample, aes(x = period, y = log10(commitment))) +
geom_boxplot()
?geom_boxplot
ggplot(data_sample, aes(x = period, y = log10(commitment))) +
geom_boxplot() +
theme_minimal()
ggplot(data_sample, aes(x = period, y = log10(ratio))) +
geom_boxplot() +
theme_minimal()
ggplot(data_sample, aes(x = period, y = log10(diff))) +
geom_boxplot() +
theme_minimal()
data_sample <- data |>
select(donor_id, recipient_id, period, ratio, diff, commitment, lag1) |>
fmutate(period = factor(period),
group = paste(donor_id, recipient_id, sep = "_")) |>
filter(uniqueN(period) == 5, .by = group) |>
arrange(desc(ratio))
data_sample <- data |>
select(donor_id, recipient_id, period, ratio, diff, commitment, lag1) |>
fmutate(period = factor(period),
group = paste(donor_id, recipient_id, sep = "_")) |>
filter(uniqueN(period) == 5, .by = group)
ggplot(data_sample, aes(x = period, y = log10(diff))) +
geom_boxplot() +
theme_minimal()
ggplot(data_sample, aes(x = period, y = diff)) +
geom_boxplot() +
theme_minimal()
ggplot(data_sample, aes(x = period, y = diff)) +
geom_boxplot(outliers = FALSE) +
theme_minimal()
ggplot(data_sample, aes(x = period, y = ratio)) +
geom_boxplot(outliers = FALSE) +
theme_minimal()
ggplot(data_sample, aes(x = period, y = commitment)) +
geom_boxplot(outliers = FALSE) +
theme_minimal()
data_sample
plot(x=period, y=commitment)
ggplot(data_sample, aes(x = period)) +
geom_histogram()
ggplot(data_sample, aes(x = period)) +
geom_histogram(stat="count")
ggplot(data_sample, aes(x = commitment)) +
geom_histogram(stat="count")
ggplot(data_sample, aes(x = commitment)) +
geom_histogram()
ggplot(data_sample, aes(x = commitment)) +
geom_histogram() +
facet_wrap(~ period) +
theme_minimal()
?Q
summarize(
N = uniqueN(group),
min =
Q1 = quantile(ratio, .25),
summarize(
N.group = uniqueN(group),
min = min(ratio, na.rm = T),
Q1 = quantile(ratio, .25),
median = median(ratio, na.rm = T),
mean = mean(ratio, na.rm = T),
Q3 = quantile(ratio, .75),
max = max(ratio, na.rm = T),
zeroes = sum(ratio == 0) / length(ratio),
.by = period)
summarize(
N.group = uniqueN(group),
min = min(ratio, na.rm = T),
max = max(ratio, na.rm = T),
zeroes = sum(ratio == 0) / length(ratio),
.by = period)
summarize(data_sample,
N.group = uniqueN(group),
min = min(ratio, na.rm = T),
Q1 = quantile(ratio, .25),
median = median(ratio, na.rm = T),
mean = mean(ratio, na.rm = T),
Q3 = quantile(ratio, .75),
max = max(ratio, na.rm = T),
zeroes = sum(ratio == 0) / length(ratio),
.by = period)
?quantile
summarize(data_sample,
N.group = uniqueN(group),
min = min(ratio, na.rm = T),
Q1 = quantile(ratio, probs = .25, na.rm = T),
median = median(ratio, na.rm = T),
mean = mean(ratio, na.rm = T),
Q3 = quantile(ratio, .75, na.rm = T),
max = max(ratio, na.rm = T),
zeroes = sum(ratio == 0) / length(ratio),
.by = period)
summarize(data_sample,
N.group = uniqueN(group),
min = min(ratio, na.rm = T),
Q1 = quantile(ratio, probs = .25, na.rm = T),
median = median(ratio, na.rm = T),
mean = mean(ratio, na.rm = T),
Q3 = quantile(ratio, .75, na.rm = T),
max = max(ratio, na.rm = T),
zeroes = length(ratio == 0) / length(ratio),
.by = period)
summarize(data_sample,
N = uniqueN(group),
min = min(ratio, na.rm = T),
Q1 = quantile(ratio, probs = .25, na.rm = T),
median = median(ratio, na.rm = T),
mean = mean(ratio, na.rm = T),
Q3 = quantile(ratio, .75, na.rm = T),
max = max(ratio, na.rm = T),
.by = period)
# create new vars for relative perioding (period) and lags (lag1)
between_periods_comparison <- copy(data_dyad)
between_periods_comparison <- between_periods_comparison[, .(donor_id, donor_name, recipient_id, recipient_name, year, commitment, treatment)
# create new variable `period` where treatment year = 0
][, period := year - year[treatment==1], by = .(donor_id, recipient_id)
# create new var `lag1`
][order(recipient_id, donor_id, year),
][, lag1 := shift(commitment, type = "lag"), by = .(donor_id, recipient_id)
# create new var `diff`
][, `:=` (
diff = commitment - lag1,
ratio = ifelse(commitment > 0 & lag1 > 0, commitment / lag1, NA)
)]
data <- between_periods_comparison[period %in% c(-5:5)]
data_sample <- data |>
select(donor_id, recipient_id, period, ratio, diff, commitment, lag1) |>
fmutate(period = factor(period),
group = paste(donor_id, recipient_id, sep = "_")) |>
filter(uniqueN(period) == 5, .by = group)
summarize(data_sample,
N = uniqueN(group),
min = min(ratio, na.rm = T),
Q1 = quantile(ratio, probs = .25, na.rm = T),
median = median(ratio, na.rm = T),
mean = mean(ratio, na.rm = T),
Q3 = quantile(ratio, .75, na.rm = T),
max = max(ratio, na.rm = T),
.by = period)
# create new vars for relative perioding (period) and lags (lag1)
between_periods_comparison <- copy(data_dyad)
between_periods_comparison <- between_periods_comparison[, .(donor_id, donor_name, recipient_id, recipient_name, year, commitment, treatment)
# create new variable `period` where treatment year = 0
][, period := year - year[treatment==1], by = .(donor_id, recipient_id)
# create new var `lag1`
][order(recipient_id, donor_id, year),
][, lag1 := shift(commitment, type = "lag"), by = .(donor_id, recipient_id)
# create new var `diff`
][, `:=` (
diff = commitment - lag1,
ratio = ifelse(commitment > 0 & lag1 > 0, commitment / lag1, NA)
)]
data <- between_periods_comparison[period %in% c(-5:5)]
data |>
select(donor_id, recipient_id, period, ratio, diff, commitment, lag1) |>
fmutate(period = factor(period),
group = paste(donor_id, recipient_id, sep = "_"))
summarize(data_sample,
N = uniqueN(group),
min = min(ratio, na.rm = T),
Q1 = quantile(ratio, probs = .25, na.rm = T),
median = median(ratio, na.rm = T),
mean = mean(ratio, na.rm = T),
Q3 = quantile(ratio, .75, na.rm = T),
max = max(ratio, na.rm = T),
.by = period)
summarize(data_sample,
N = uniqueN(group),
min = min(ratio, na.rm = T),
Q1 = quantile(ratio, probs = .25, na.rm = T),
median = median(ratio, na.rm = T),
mean = mean(ratio, na.rm = T),
Q3 = quantile(ratio, .75, na.rm = T),
max = max(ratio, na.rm = T),
.by = period)
data_sample <- data |>
select(donor_id, recipient_id, period, ratio, diff, commitment, lag1) |>
fmutate(period = factor(period),
group = paste(donor_id, recipient_id, sep = "_"))
#  filter(uniqueN(period) == 5, .by = group)
summarize(data_sample,
N = uniqueN(group),
min = min(ratio, na.rm = T),
Q1 = quantile(ratio, probs = .25, na.rm = T),
median = median(ratio, na.rm = T),
mean = mean(ratio, na.rm = T),
Q3 = quantile(ratio, .75, na.rm = T),
max = max(ratio, na.rm = T),
.by = period)
data_sample <- data |>
select(donor_id, recipient_id, commitment) |>
fmutate(period = factor(period),
group = paste(donor_id, recipient_id, sep = "_"))
data_sample <- data |>
select(donor_id, recipient_id, commitment) |>
fmutate(period = factor(period),
group = paste(donor_id, recipient_id, sep = "_"))
data
data |>
select(donor_id, recipient_id, commitment) |>
fmutate(period = factor(period),
group = paste(donor_id, recipient_id, sep = "_"))
data |>
select(donor_id, recipient_id, commitment)
summarize(data_sample,
N = uniqueN(group),
min = min(commitment, na.rm = T),
Q1 = quantile(commitment, probs = .25, na.rm = T),
median = median(commitment, na.rm = T),
mean = mean(commitment, na.rm = T),
Q3 = quantile(commitment, .75, na.rm = T),
max = max(commitment, na.rm = T),
.by = period)
data_sample <- data |>
select(donor_id, recipient_id, commitment, period) |>
fmutate(period = factor(period),
group = paste(donor_id, recipient_id, sep = "_"))
summarize(data_sample,
N = uniqueN(group),
min = min(commitment, na.rm = T),
Q1 = quantile(commitment, probs = .25, na.rm = T),
median = median(commitment, na.rm = T),
mean = mean(commitment, na.rm = T),
Q3 = quantile(commitment, .75, na.rm = T),
max = max(commitment, na.rm = T),
.by = period)
summarize(data_sample,
share_zeroes = sum(commitment==0, na.rm = T) / length(commitment),
.by = period)
summarize(data_sample,
share_zeroes = sum(commitment==0, na.rm = T) / length(commitment) * 100,
.by = period)
summarize(data_sample,
share_zeroes = round(sum(commitment==0, na.rm = T) / length(commitment) * 100, 2),
.by = period)
summarize(data_sample[commitment > 0,],
N = uniqueN(group),
min = min(commitment, na.rm = T),
Q1 = quantile(commitment, probs = .25, na.rm = T),
median = median(commitment, na.rm = T),
mean = mean(commitment, na.rm = T),
Q3 = quantile(commitment, .75, na.rm = T),
max = max(commitment, na.rm = T),
.by = period)
# create new vars for relative perioding (period) and lags (lag1)
between_periods_comparison <- copy(data_dyad)
between_periods_comparison
between_periods_comparison <- between_periods_comparison[, .(donor_id, donor_name,
recipient_id, recipient_name,
year,
outcome = commit.channel_nonstate,
treatment)
# create new variable `period` where treatment year = 0
][, period := year - year[treatment==1], by = .(donor_id, recipient_id)
# create new var `lag1`
][order(recipient_id, donor_id, year),
][, lag1 := shift(outcome, type = "lag"), by = .(donor_id, recipient_id)
# create new var `diff`
][, `:=` (
diff = outcome - lag1,
ratio = ifelse(outcome > 0 & lag1 > 0, outcome / lag1, NA)
)]
# create new vars for relative perioding (period) and lags (lag1)
between_periods_comparison <- copy(data_dyad)
between_periods_comparison <- between_periods_comparison[, .(donor_id, donor_name,
recipient_id, recipient_name,
year,
outcome = commit.channel_nonstate,
treatment)
# create new variable `period` where treatment year = 0
][, period := year - year[treatment==1], by = .(donor_id, recipient_id)
# create new var `lag1`
][order(recipient_id, donor_id, year),
][, lag1 := shift(outcome, type = "lag"), by = .(donor_id, recipient_id)
# create new var `diff`
][, `:=` (
diff = outcome - lag1,
ratio = ifelse(outcome > 0 & lag1 > 0, outcome / lag1, NA)
)]
between_periods_comparison
between_periods_comparison
data <- between_periods_comparison[period %in% c(-5:5)]
data
# create new vars for relative perioding (period) and lags (lag1)
between_periods_comparison <- copy(data_dyad)
between_periods_comparison <- between_periods_comparison[, .(donor_id, donor_name,
recipient_id, recipient_name,
year,
outcome = commit.channel_nonstate,
treatment)
# create new variable `period` where treatment year = 0
][, period := year - year[treatment==1], by = .(donor_id, recipient_id)
# create new var `lag1`
]
between_periods_comparison
between_periods_comparison
# create new vars for relative perioding (period) and lags (lag1)
between_periods_comparison <- copy(data_dyad)
between_periods_comparison <- between_periods_comparison[, .(donor_id, donor_name,
recipient_id, recipient_name,
year,
outcome = commit.channel_nonstate,
treatment)
# create new variable `period` where treatment year = 0
][, period := year - year[treatment==1], by = .(donor_id, recipient_id)
# create new var `lag1`
][order(recipient_id, donor_id, year),
][, lag1 := shift(outcome, type = "lag"), by = .(donor_id, recipient_id)
# create new var `diff`
][, `:=` (
diff = outcome - lag1,
ratio = ifelse(outcome > 0 & lag1 > 0, outcome / lag1, NA)
)]
data <- between_periods_comparison[period %in% c(-5:5)]
data
data_sample <- data |>
select(donor_id, recipient_id, outcome, period) |>
fmutate(period = factor(period),
group = paste(donor_id, recipient_id, sep = "_"))
#  filter(uniqueN(period) == 5, .by = group)
summarize(data_sample,
share_zeroes = round(sum(outcome==0, na.rm = T) / length(outcome) * 100, 2),
.by = period)
summarize(data_sample[outcome > 0,],
N = uniqueN(group),
min = min(outcome, na.rm = T),
Q1 = quantile(outcome, probs = .25, na.rm = T),
median = median(outcome, na.rm = T),
mean = mean(outcome, na.rm = T),
Q3 = quantile(outcome, .75, na.rm = T),
max = max(outcome, na.rm = T),
.by = period)
data_sample <- data |>
select(donor_id, recipient_id, ratio, diff, period) |>
fmutate(period = factor(period),
group = paste(donor_id, recipient_id, sep = "_"))
#  filter(uniqueN(period) == 5, .by = group)
summarize(data_sample,
share_zeroes = round(sum(ratio==0, na.rm = T) / length(ratio) * 100, 2),
.by = period)
summarize(data_sample[ratio > 0,],
N = uniqueN(group),
min = min(ratio, na.rm = T),
Q1 = quantile(ratio, probs = .25, na.rm = T),
median = median(ratio, na.rm = T),
mean = mean(ratio, na.rm = T),
Q3 = quantile(ratio, .75, na.rm = T),
max = max(ratio, na.rm = T),
.by = period)
data |>
slice_max(outcome, n=5)
data |>
slice_max(ratio, n=5)
data |>
filter(lag1 > 1) |>
slice_max(ratio, n=5)
View(data_crs)
data_crs |>
distinct(donor_id, donor_name, bi_multi)
data_crs |> distinct(recipient_id, recipient_name, incomegroup_name)
